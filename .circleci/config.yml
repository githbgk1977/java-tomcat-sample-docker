version: 2.1

executors:
  test-executor:
    docker:
      - image: circleci/openjdk:11  # Use OpenJDK image with Maven

jobs:
  test_image:
    executor: test-executor
    steps:
      - checkout
      
      - run:
          name: Check and Install Docker
          command: |
            echo "Checking Docker installation..."
            if ! command -v docker &> /dev/null; then
                echo "Docker is not installed. Installing Docker..."
                sudo apt-get update
                sudo apt-get install -y docker.io
            else
                echo "Docker is already installed."
                docker --version
            fi

      - run:
          name: Check OpenJDK Installation
          command: |
            echo "Checking OpenJDK installation..."
            if ! command -v java &> /dev/null; then
                echo "OpenJDK is not installed. Please install it."
            else
                echo "OpenJDK is already installed."
                java -version
            fi

      - run:
          name: Check Maven Installation
          command: |
            echo "Checking Maven installation..."
            if ! command -v mvn &> /dev/null; then
                echo "Maven is not installed. Please install it."
            else
                echo "Maven is already installed."
                mvn -v
            fi

      - run:
          name: Check Git Installation
          command: |
            echo "Checking Git installation..."
            if ! command -v git &> /dev/null; then
                echo "Git is not installed. Installing Git..."
                sudo apt-get update
                sudo apt-get install -y git
            else
                echo "Git is already installed."
                git --version
            fi

workflows:
  version: 2
  test_workflow:
    jobs:
      - test_image
